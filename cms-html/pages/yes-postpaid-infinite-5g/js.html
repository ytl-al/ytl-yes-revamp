<script type="text/javascript" src="/wp-content/themes/yes-twentytwentyone/template-parts/elevate/assets/js/elevate.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        checkStockAPI();

        var url_string = window.location.href;
        var url = new URL(url_string);
        var paramDevice = url.searchParams.get('device');
        var targetDevice = $('#device-' + paramDevice);
        if ($(targetDevice)) {
            var parentAccordionContent = $(targetDevice).closest('.accordion-collapse').siblings('.layer-accordionPlanDetails');
            var btnAccordion = $(parentAccordionContent).find('.accordion-button');

            $(btnAccordion).trigger('click');

            setTimeout(function() {
                var parentAccordionContentID = $(parentAccordionContent).closest('.layer-accordionPlan').attr('id');
                var targetSection = $('#' + parentAccordionContentID);
                if (targetSection.length > 0) {
                    var targetOffset = $(targetSection).offset().top - 140;
                    $('html, body').animate({
                        scrollTop: targetOffset
                    }, 100);
                }
            }, 1000);
        }
    });
    function checkStockAPI() {
        toggleOverlay();
        $.ajax({
            url: '/wp-json/elevate/v1/check-stock', 
            method: 'GET', 
            success: function(data) {
                Object.values(data).map(function(item) {
                    var bundleID    = item.productBundleId;
                    var balance     = item.balance;
                    var btnBuyNow   = $('.layer-planDevice .panel-btn .btn[data-productid="' + bundleID + '"]');
                    if (balance == 0 && $(btnBuyNow)) {
                        var parentBtnBuyNow = $(btnBuyNow).closest('.panel-btn');
                        var btnOOSHTML  = '<span class="span-oos">Out of Stock</span>';
                        $(btnBuyNow).remove();
                        $(parentBtnBuyNow).append(btnOOSHTML);
                    }
                });
            },
            error: function(error) {
                console.log(error);
            },
            complete: function() {
                toggleOverlay(false);
            }
        });
    }
</script>